{% extends 'base.html' %}

{% block title %}Importar Histórico{% endblock %}

{% block content %}
<div class="page-header">
    <h2><i class="bi bi-upload icon-text"></i> Importar Histórico</h2>
</div>

<div class="import-container simple-import">
    <form method="POST" enctype="multipart/form-data" id="formImportar">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="file" id="arquivo" name="arquivo" accept=".csv,.xlsx,.xls" required style="display:none">

        <div class="button-group center-buttons">
            <button type="button" class="btn-primary" id="btnImportar">Importar Histórico</button>
            {# Importacao em massa (DESATIVADA): Mantido comentado para referencia futura. #}
            {# <a href="{{ url_for('pedidos.download_modelo_pedidos') }}" class="btn-secondary">Baixar modelo</a> #}
        </div>
    </form>
</div>

<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="spinner"></div>
    <p>Enviando arquivo...</p>
</div>

<style nonce="{{ nonce }}">
    .import-container { margin-top: 20px; }
    .simple-import .button-group {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
    }
    .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: #fff;
        z-index: 9999;
    }
    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #fff;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
</style>

<script nonce="{{ nonce }}">
document.addEventListener('DOMContentLoaded', () => {
    const btnImportar = document.getElementById('btnImportar');
    const fileInput = document.getElementById('arquivo');
    const form = document.getElementById('formImportar');
    const overlay = document.getElementById('loadingOverlay');

    if (btnImportar && fileInput && form) {
        btnImportar.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                if (overlay) overlay.style.display = 'flex';
                // Remove conteúdo para cumprir pedido de ocultar página
                document.body.innerHTML = '';
                form.submit();
            }
        });
    }
});
</script>
{% endblock %}
